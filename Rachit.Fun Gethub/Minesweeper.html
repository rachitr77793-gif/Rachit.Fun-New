<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rachit.Fun â€” Minesweeper</title>
<style>
  :root{--card:#fff}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#f7fbff;color:#071133}

  /* exact ribbon style (taskbar) */
  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 20px;
    background:transparent;
    border-bottom:1px solid rgba(0,0,0,0.03);
    position:sticky;
    top:0;
    z-index:50;
  }
  .left{display:flex;align-items:center;gap:12px;font-weight:800}
  .left .logo{font-size:20px}
  .left .site{font-size:20px}
  .right{display:flex;align-items:center;gap:10px}
  .color-picker{width:36px;height:28px;border-radius:8px;border:1px solid #ccc;padding:0}
  .btn{background:var(--card);border:1px solid rgba(0,0,0,0.06);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}

  main{max-width:1100px;margin:28px auto;padding:20px;text-align:center}

  .game-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .game-title{font-size:28px;font-weight:900;margin-top:6px}

  .controls{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:6px}
  select, .action-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);font-weight:700;background:#fff;cursor:pointer}

  #timer{font-weight:800;margin-top:6px}

  /* ---------- CENTERED & LARGER GRID ---------- */
  #board {
    display: grid;
    margin: 18px auto;            /* center horizontally */
    /* gridTemplateColumns set dynamically in JS to repeat(cols, 42px) */
    gap: 6px;
    justify-content: center;     /* ensure centered inside container */
  }

  /* Bigger cells (42px) for easier view */
  .cell {
    width: 42px;
    height: 42px;
    border-radius:6px;
    border:1px solid #9aa6b3;
    background:#d7e3fc;
    font-size:18px;
    font-weight:700;
    color:#0b2540;
    display:flex;
    align-items:center;
    justify-content:center;
    user-select:none;
    cursor:pointer;
  }
  .cell.revealed { background:#ffffff; cursor:default; color:#0b2540; }
  .cell.mine { background:#ff6b6b; color:#fff; }
  .cell.flag { background:#ffd166; color:#0b2540; }

  /* responsive: shrink slightly on very small screens */
  @media (max-width:420px){
    .cell{ width:calc((92vw - 6px*3)/4); height:calc((92vw - 6px*3)/4); font-size:16px; }
  }

  .game-over{color:#b91c1c;font-weight:900;margin-top:8px}
</style>
</head>
<body>

<!-- EXACT TASKBAR (unchanged) -->
<header class="topbar">
  <div class="left">
    <div class="logo">ðŸŽ®</div>
    <div class="site">Rachit.Fun</div>
  </div>

  <div class="right">
    <label style="display:flex;align-items:center;gap:8px;font-weight:700">
      BG
      <input id="bgPicker" class="color-picker" type="color" value="#f7fbff" />
    </label>

    <button class="btn" id="homeBtn">Home</button>
    <button class="btn" id="resetAllBtn">Reset All</button>
  </div>
</header>

<main>
  <div class="game-wrap">
    <div class="game-title">MINESWEEPER</div>

    <div class="controls">
      <label style="font-weight:800">Difficulty</label>
      <select id="difficulty" aria-label="Difficulty">
        <option value="easy">Easy â€” 9Ã—9 (10 mines)</option>
        <option value="normal">Normal â€” 16Ã—16 (40 mines)</option>
        <option value="hard">Hard â€” 24Ã—24 (99 mines)</option>
      </select>

      <button class="action-btn" id="startBtn">START</button>
      <button class="action-btn" id="resetBtn">RESET</button>
    </div>

    <div id="timer">Time: 0s</div>

    <div id="board" role="grid" aria-label="Minesweeper board"></div>

    <div id="gameOver" class="game-over" aria-live="polite"></div>
  </div>
</main>

<script>
/* === BG persistence (unchanged) === */
const BG_KEY = 'rachit_bg';
const bgPicker = document.getElementById('bgPicker');
const saved = localStorage.getItem(BG_KEY);
if (saved) { document.body.style.background = saved; bgPicker.value = saved; }
bgPicker.addEventListener('input', e => { document.body.style.background = e.target.value; localStorage.setItem(BG_KEY, e.target.value); });

document.getElementById('homeBtn').addEventListener('click', () => { window.location.href = 'index.html'; });
document.getElementById('resetAllBtn').addEventListener('click', () => {
  if (!confirm('Reset everything? This clears BG setting.')) return;
  localStorage.removeItem(BG_KEY);
  location.reload();
});

/* === Minesweeper logic with centered, larger grid (42px) === */
const boardEl = document.getElementById('board');
const timerEl = document.getElementById('timer');
const gameOverEl = document.getElementById('gameOver');
const difficultySelect = document.getElementById('difficulty');

let rows, cols, mines;
let board = [];
let timer = 0, interval = null;
let running = false;

function setDifficulty(level){
  if(level === 'easy'){ rows = cols = 9; mines = 10; }
  else if(level === 'normal'){ rows = cols = 16; mines = 40; }
  else { rows = cols = 24; mines = 99; }
}

function startTimer(){
  clearInterval(interval);
  timer = 0;
  timerEl.textContent = 'Time: 0s';
  interval = setInterval(()=> { timer++; timerEl.textContent = 'Time: ' + timer + 's'; }, 1000);
}

function stopTimer(){ clearInterval(interval); }

/* create board and render */
function createBoard(){
  boardEl.innerHTML = '';
  board = [];
  // ensure JS uses the 42px width used in CSS, but we define columns dynamically
  boardEl.style.gridTemplateColumns = `repeat(${cols}, 42px)`;
  boardEl.style.gap = '6px';

  for(let r=0;r<rows;r++){
    board[r] = [];
    for(let c=0;c<cols;c++){
      board[r][c] = { mine:false, revealed:false, flagged:false, el:null };
      const div = document.createElement('div');
      div.className = 'cell';
      div.setAttribute('data-r', r);
      div.setAttribute('data-c', c);

      // left click -> reveal
      div.addEventListener('click', ()=> {
        if(!running) return;
        revealCell(r,c);
      });

      // right click -> flag
      div.addEventListener('contextmenu', (e)=> {
        e.preventDefault();
        if(!running) return;
        toggleFlag(r,c);
      });

      board[r][c].el = div;
      boardEl.appendChild(div);
    }
  }
}

/* place mines randomly */
function placeMines(){
  let placed = 0;
  while(placed < mines){
    const r = Math.floor(Math.random()*rows);
    const c = Math.floor(Math.random()*cols);
    if(!board[r][c].mine){
      board[r][c].mine = true;
      placed++;
    }
  }
}

/* start & reset */
function startGame(){
  setDifficulty(difficultySelect.value);
  running = true;
  gameOverEl.textContent = '';
  createBoard();
  placeMines();
  startTimer();
}

function resetGame(){
  startGame();
}

/* helper: count adjacent mines */
function countAdj(r,c){
  let cnt = 0;
  for(let dr=-1; dr<=1; dr++){
    for(let dc=-1; dc<=1; dc++){
      if(dr===0 && dc===0) continue;
      const nr = r+dr, nc = c+dc;
      if(nr>=0 && nr<rows && nc>=0 && nc<cols){
        if(board[nr][nc].mine) cnt++;
      }
    }
  }
  return cnt;
}

/* reveal cell */
function revealCell(r,c){
  const cell = board[r][c];
  if(cell.revealed || cell.flagged) return;
  cell.revealed = true;
  const el = cell.el;
  el.classList.add('revealed');

  if(cell.mine){
    el.classList.add('mine');
    gameOver(false);
    return;
  }

  const cnt = countAdj(r,c);
  if(cnt>0){
    el.textContent = cnt;
  } else {
    // flood fill neighbors
    for(let dr=-1; dr<=1; dr++){
      for(let dc=-1; dc<=1; dc++){
        const nr = r+dr, nc = c+dc;
        if(nr>=0 && nr<rows && nc>=0 && nc<cols){
          if(!board[nr][nc].revealed && !board[nr][nc].mine){
            revealCell(nr,nc);
          }
        }
      }
    }
  }

  checkWin();
}

/* toggle flag */
function toggleFlag(r,c){
  const cell = board[r][c];
  if(cell.revealed) return;
  cell.flagged = !cell.flagged;
  cell.el.classList.toggle('flag', cell.flagged);
}

/* check win */
function checkWin(){
  let revealed = 0;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(board[r][c].revealed) revealed++;
    }
  }
  const safeCells = rows*cols - mines;
  if(revealed >= safeCells){
    gameOver(true);
  }
}

/* game over */
function gameOver(win){
  running = false;
  stopTimer();
  if(win){
    gameOverEl.textContent = 'ðŸŽ‰ You Win!';
    alert('ðŸŽ‰ You Win!');
  } else {
    gameOverEl.textContent = 'ðŸ’¥ Game Over';
    alert('ðŸ’¥ Game Over!');
    // reveal mines
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        if(board[r][c].mine){
          board[r][c].el.classList.add('mine');
        }
      }
    }
  }
}

/* wire UI */
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('resetBtn').addEventListener('click', resetGame);

/* initialize with a default game centered & visible */
startGame();
</script>
</body>
</html>
